const o={serverUrl:"http://localhost:1420",apiKeys:[],translateModel:"gemini-flash-latest",includeFreeText:!1,bananaMode:!1,textStroke:!1,blurFreeTextBg:!1,cache:!0,metricsDetail:!0,geminiThinking:!1,tighterBounds:!1,useMask:!0,mergeImg:!1,batchSize:5,sessionLimit:8,theme:"auto"};async function r(){try{const t=await chrome.storage.sync.get(Object.keys(o));return{...o,...t}}catch(t){return console.error("[Storage] Failed to load settings:",t),o}}async function c(t){try{await chrome.storage.sync.set(t)}catch(e){throw console.error("[Storage] Failed to save settings:",e),e}}const a="cumulativeStats";async function l(){try{return(await chrome.storage.local.get(a))[a]||{totalSessions:0,totalImages:0,totalRegions:0,totalSimpleBg:0,totalComplexBg:0,totalApiCalls:0,totalInputTokens:0,totalOutputTokens:0,totalCacheHits:0,totalCacheMisses:0,totalProcessingTimeMs:0}}catch(t){return console.error("[Storage] Failed to load cumulative stats:",t),{totalSessions:0,totalImages:0,totalRegions:0,totalSimpleBg:0,totalComplexBg:0,totalApiCalls:0,totalInputTokens:0,totalOutputTokens:0,totalCacheHits:0,totalCacheMisses:0,totalProcessingTimeMs:0}}}async function i(t){try{const e=await l(),s={totalSessions:e.totalSessions+1,totalImages:e.totalImages+(t.total_images||0),totalRegions:e.totalRegions+(t.total_regions||0),totalSimpleBg:e.totalSimpleBg+(t.simple_bg_count||0),totalComplexBg:e.totalComplexBg+(t.complex_bg_count||0),totalApiCalls:e.totalApiCalls+(t.api_calls_simple||0)+(t.api_calls_complex||0)+(t.api_calls_banana||0),totalInputTokens:e.totalInputTokens+(t.input_tokens||0),totalOutputTokens:e.totalOutputTokens+(t.output_tokens||0),totalCacheHits:e.totalCacheHits+(t.cache_hits||0),totalCacheMisses:e.totalCacheMisses+(t.cache_misses||0),totalProcessingTimeMs:e.totalProcessingTimeMs+(t.total_time_ms||0),lastProcessedAt:Date.now(),firstProcessedAt:e.firstProcessedAt||Date.now()};await chrome.storage.local.set({[a]:s}),console.log("[Storage] Cumulative stats updated:",s)}catch(e){console.error("[Storage] Failed to save cumulative stats:",e)}}async function n(){try{await chrome.storage.local.remove(a),console.log("[Storage] Cumulative stats reset")}catch(t){console.error("[Storage] Failed to reset cumulative stats:",t)}}export{r as a,i as b,l,n as r,c as s};
