console.log("[BACKGROUND] Manga Text Processor: Service worker initializing...");chrome.commands.onCommand.addListener(async t=>{if(console.log(`[BACKGROUND] Command received: ${t}`),t==="process-page-images")try{const[o]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!o?.id){console.error("[BACKGROUND] No active tab found");return}const e=await chrome.storage.sync.get(["serverUrl","apiKeys","translateModel","includeFreeText","bananaMode","textStroke","blurFreeTextBg","cache","metricsDetail"]),s={serverUrl:e.serverUrl||"http://localhost:1420",apiKeys:e.apiKeys||[],translateModel:e.translateModel||"gemini-flash-latest",includeFreeText:e.includeFreeText||!1,bananaMode:e.bananaMode||!1,textStroke:e.textStroke||!1,blurFreeTextBg:e.blurFreeTextBg||!1,cache:e.cache!==void 0?e.cache:!0,metricsDetail:e.metricsDetail!==void 0?e.metricsDetail:!0},r=await chrome.tabs.sendMessage(o.id,{action:"process-images",config:s});console.log("[BACKGROUND] Response:",r)}catch(o){console.error("[BACKGROUND] Failed to process:",o)}});chrome.runtime.onMessage.addListener((t,o,e)=>(console.log("[BACKGROUND] Message received:",t),["processing-update","processing-complete","processing-error"].includes(t.action)&&chrome.runtime.sendMessage(t).catch(r=>{console.log("[BACKGROUND] Could not forward to popup:",r.message)}),e({status:"received"}),!1));chrome.runtime.onInstalled.addListener(t=>{if(console.log("[BACKGROUND] Extension installed/updated:",t.reason),t.reason==="install"){const o={serverUrl:"http://localhost:1420",apiKeys:[],translateModel:"gemini-flash-latest",includeFreeText:!1,bananaMode:!1,textStroke:!1,blurFreeTextBg:!1,cache:!0,metricsDetail:!0,theme:"auto"};chrome.storage.sync.set(o),console.log("[BACKGROUND] Default settings initialized")}});console.log("[BACKGROUND] Service worker ready");console.log("[BACKGROUND] Keyboard shortcut: Ctrl+Shift+M (Cmd+Shift+M on Mac)");
